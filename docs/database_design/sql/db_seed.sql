-- ============================================
-- Online Auction System - Database Seed Data
-- DBMS: PostgreSQL 13+ (Supabase Compatible)
-- Note: Run this after db_init.sql
-- ============================================

-- Reset sequences to ensure clean start
SELECT setval('users_id_seq', 1, false);
SELECT setval('categories_category_id_seq', 1, false);
SELECT setval('products_product_id_seq', 1, false);

-- ============================================
-- 1. SEED USERS
-- ============================================

-- Insert test users (password: 'Password123' hashed with bcrypt)
-- bcrypt hash for 'Password123': $2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi
INSERT INTO users (full_name, email, password, status, is_verified) VALUES
('Admin User', 'admin@auction.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE),
('John Seller', 'john.seller@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE),
('Jane Bidder', 'jane.bidder@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE),
('Bob Smith', 'bob.smith@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE),
('Alice Johnson', 'alice.johnson@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE),
('Charlie Brown', 'charlie.brown@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'pending_verification', FALSE),
('David Lee', 'david.lee@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'active', TRUE);

-- ============================================
-- 2. ASSIGN ROLES TO USERS
-- ============================================

-- Admin role to user 1
INSERT INTO users_roles (user_id, role_id)
SELECT u.id, r.role_id 
FROM users u, roles r 
WHERE u.email = 'admin@auction.com' AND r.name = 'admin';

-- Seller role to user 2 (John)
INSERT INTO users_roles (user_id, role_id)
SELECT u.id, r.role_id 
FROM users u, roles r 
WHERE u.email = 'john.seller@example.com' AND r.name = 'seller';

-- Bidder role to users 3, 4, 5, 7 (Jane, Bob, Alice, David)
INSERT INTO users_roles (user_id, role_id)
SELECT u.id, r.role_id 
FROM users u, roles r 
WHERE u.email IN ('jane.bidder@example.com', 'bob.smith@example.com', 'alice.johnson@example.com', 'david.lee@example.com')
AND r.name = 'bidder';

-- User 2 (John Seller) also has bidder role
INSERT INTO users_roles (user_id, role_id)
SELECT u.id, r.role_id 
FROM users u, roles r 
WHERE u.email = 'john.seller@example.com' AND r.name = 'bidder';

-- ============================================
-- 3. SEED CATEGORIES
-- ============================================

-- Parent categories (2-level hierarchy)
INSERT INTO categories (name, parent_id) VALUES
('Electronics', NULL),
('Fashion', NULL),
('Home & Garden', NULL),
('Sports', NULL),
('Books', NULL),
('Collectibles', NULL);

-- Child categories (slug will be auto-generated by trigger)
INSERT INTO categories (name, parent_id) VALUES
-- Electronics children
('Smartphones', (SELECT category_id FROM categories WHERE name = 'Electronics' AND parent_id IS NULL)),
('Laptops', (SELECT category_id FROM categories WHERE name = 'Electronics' AND parent_id IS NULL)),
('Cameras', (SELECT category_id FROM categories WHERE name = 'Electronics' AND parent_id IS NULL)),
('Gaming Consoles', (SELECT category_id FROM categories WHERE name = 'Electronics' AND parent_id IS NULL)),

-- Fashion children
('Men Clothing', (SELECT category_id FROM categories WHERE name = 'Fashion' AND parent_id IS NULL)),
('Women Clothing', (SELECT category_id FROM categories WHERE name = 'Fashion' AND parent_id IS NULL)),
('Watches', (SELECT category_id FROM categories WHERE name = 'Fashion' AND parent_id IS NULL)),
('Shoes', (SELECT category_id FROM categories WHERE name = 'Fashion' AND parent_id IS NULL)),

-- Home & Garden children
('Furniture', (SELECT category_id FROM categories WHERE name = 'Home & Garden' AND parent_id IS NULL)),
('Kitchen Appliances', (SELECT category_id FROM categories WHERE name = 'Home & Garden' AND parent_id IS NULL)),
('Garden Tools', (SELECT category_id FROM categories WHERE name = 'Home & Garden' AND parent_id IS NULL)),

-- Sports children
('Fitness Equipment', (SELECT category_id FROM categories WHERE name = 'Sports' AND parent_id IS NULL)),
('Bicycles', (SELECT category_id FROM categories WHERE name = 'Sports' AND parent_id IS NULL)),
('Outdoor Gear', (SELECT category_id FROM categories WHERE name = 'Sports' AND parent_id IS NULL)),

-- Books children
('Fiction', (SELECT category_id FROM categories WHERE name = 'Books' AND parent_id IS NULL)),
('Non-Fiction', (SELECT category_id FROM categories WHERE name = 'Books' AND parent_id IS NULL)),
('Textbooks', (SELECT category_id FROM categories WHERE name = 'Books' AND parent_id IS NULL)),

-- Collectibles children
('Vintage Items', (SELECT category_id FROM categories WHERE name = 'Collectibles' AND parent_id IS NULL)),
('Art', (SELECT category_id FROM categories WHERE name = 'Collectibles' AND parent_id IS NULL)),
('Coins & Stamps', (SELECT category_id FROM categories WHERE name = 'Collectibles' AND parent_id IS NULL));

-- ============================================
-- 4. SEED PRODUCTS (ACTIVE AUCTIONS)
-- ============================================

INSERT INTO products (
    category_id, 
    seller_id, 
    name, 
    thumbnail_url,
    current_price, 
    buy_now_price,
    start_price, 
    step_price,
    start_time,
    end_time,
    auto_extend,
    status
) VALUES
-- Product 1: iPhone 14 Pro
(
    (SELECT category_id FROM categories WHERE name = 'Smartphones'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    'iPhone 14 Pro 256GB - Space Black',
    'https://example.com/images/iphone14pro.jpg',
    800.00,
    1200.00,
    750.00,
    50.00,
    CURRENT_TIMESTAMP - INTERVAL '2 days',
    CURRENT_TIMESTAMP + INTERVAL '5 days',
    TRUE,
    'active'
),
-- Product 2: MacBook Pro
(
    (SELECT category_id FROM categories WHERE name = 'Laptops'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    'MacBook Pro M2 16" - 512GB SSD',
    'https://example.com/images/macbookpro.jpg',
    1500.00,
    2500.00,
    1400.00,
    100.00,
    CURRENT_TIMESTAMP - INTERVAL '1 day',
    CURRENT_TIMESTAMP + INTERVAL '6 days',
    TRUE,
    'active'
),
-- Product 3: Canon Camera
(
    (SELECT category_id FROM categories WHERE name = 'Cameras'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    'Canon EOS R6 Mark II - Body Only',
    'https://example.com/images/canonr6.jpg',
    2000.00,
    2800.00,
    1900.00,
    100.00,
    CURRENT_TIMESTAMP - INTERVAL '3 hours',
    CURRENT_TIMESTAMP + INTERVAL '7 days',
    TRUE,
    'active'
),
-- Product 4: Vintage Watch
(
    (SELECT category_id FROM categories WHERE name = 'Watches'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    'Rolex Submariner Vintage 1980s',
    'https://example.com/images/rolex.jpg',
    5000.00,
    8000.00,
    4500.00,
    250.00,
    CURRENT_TIMESTAMP - INTERVAL '1 day',
    CURRENT_TIMESTAMP + INTERVAL '10 days',
    FALSE,
    'active'
),
-- Product 5: Gaming Console
(
    (SELECT category_id FROM categories WHERE name = 'Gaming Consoles'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    'PlayStation 5 Digital Edition - Like New',
    'https://example.com/images/ps5.jpg',
    400.00,
    550.00,
    350.00,
    25.00,
    CURRENT_TIMESTAMP - INTERVAL '4 days',
    CURRENT_TIMESTAMP + INTERVAL '3 days',
    TRUE,
    'active'
);

-- ============================================
-- 5. SEED PRODUCT DESCRIPTIONS
-- ============================================

INSERT INTO product_descriptions (product_id, author_id, content, lang, version) VALUES
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Brand new iPhone 14 Pro in Space Black. 256GB storage, unlocked, includes original box and accessories. Perfect condition, never used.', 'vi', 1),
 
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'MacBook Pro 16" with M2 chip, 16GB RAM, 512GB SSD. Lightly used for 6 months, excellent condition. Includes charger and original packaging.', 'vi', 1),
 
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Canon EOS R6 Mark II mirrorless camera body. Professional grade, low shutter count (2000 actuations). Perfect for photographers upgrading from DSLR.', 'vi', 1),
 
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Authentic Rolex Submariner from 1980s. Serviced recently, keeps excellent time. Comes with papers and service history. A true collector''s piece.', 'vi', 1),
 
((SELECT product_id FROM products WHERE name LIKE 'PlayStation%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'PlayStation 5 Digital Edition in excellent condition. Used for 3 months, adult-owned, smoke-free home. Includes one controller and cables.', 'vi', 1);

-- ============================================
-- 6. SEED PRODUCT IMAGES
-- ============================================

INSERT INTO product_images (product_id, image_url) VALUES
-- iPhone images
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 'https://example.com/images/iphone14pro-1.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 'https://example.com/images/iphone14pro-2.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 'https://example.com/images/iphone14pro-3.jpg'),
-- MacBook images
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 'https://example.com/images/macbookpro-1.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 'https://example.com/images/macbookpro-2.jpg'),
-- Camera images
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 'https://example.com/images/canonr6-1.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 'https://example.com/images/canonr6-2.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 'https://example.com/images/canonr6-3.jpg'),
-- Watch images
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 'https://example.com/images/rolex-1.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 'https://example.com/images/rolex-2.jpg'),
-- PS5 images
((SELECT product_id FROM products WHERE name LIKE 'PlayStation%' LIMIT 1), 'https://example.com/images/ps5-1.jpg'),
((SELECT product_id FROM products WHERE name LIKE 'PlayStation%' LIMIT 1), 'https://example.com/images/ps5-2.jpg');

-- ============================================
-- 7. SEED BIDS
-- ============================================

-- Bids on iPhone
INSERT INTO bids (product_id, bidder_id, amount, is_auto) VALUES
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 750.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'bob.smith@example.com'), 800.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 850.00, FALSE);

-- Bids on MacBook
INSERT INTO bids (product_id, bidder_id, amount, is_auto) VALUES
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 1400.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'bob.smith@example.com'), 1500.00, FALSE);

-- Bids on Camera
INSERT INTO bids (product_id, bidder_id, amount, is_auto) VALUES
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 1900.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 2000.00, FALSE);

-- Bids on Watch
INSERT INTO bids (product_id, bidder_id, amount, is_auto) VALUES
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'david.lee@example.com'), 4500.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 4750.00, FALSE),
((SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'david.lee@example.com'), 5000.00, FALSE);

-- ============================================
-- 8. SEED AUTO BIDS
-- ============================================

INSERT INTO auto_bids (product_id, bidder_id, max_amount) VALUES
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 1000.00),
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 2000.00),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'bob.smith@example.com'), 2500.00);

-- ============================================
-- 9. SEED WATCHLIST
-- ============================================

INSERT INTO watchlist (user_id, product_id) VALUES
((SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'bob.smith@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'bob.smith@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1)),
((SELECT id FROM users WHERE email = 'david.lee@example.com'), 
 (SELECT product_id FROM products WHERE name LIKE 'Rolex%' LIMIT 1));

-- ============================================
-- 10. SEED PRODUCT COMMENTS
-- ============================================

-- First insert parent comments
INSERT INTO product_comments (product_id, user_id, content, parent_id) VALUES
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 
 'Is this unlocked for all carriers?', NULL),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'bob.smith@example.com'), 
 'What is the battery health percentage?', NULL),
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 
 'Does this have AppleCare+?', NULL),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 
 'Any scratches on the sensor or body?', NULL);

-- Then insert replies
INSERT INTO product_comments (product_id, user_id, content, parent_id) VALUES
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Yes, it is factory unlocked and works with all carriers worldwide.', 
 (SELECT comment_id FROM product_comments WHERE content LIKE 'Is this unlocked%' LIMIT 1)),
((SELECT product_id FROM products WHERE name LIKE 'iPhone%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Battery health is 100% as it is brand new.', 
 (SELECT comment_id FROM product_comments WHERE content LIKE 'What is the battery%' LIMIT 1)),
((SELECT product_id FROM products WHERE name LIKE 'MacBook%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Yes, AppleCare+ is valid until 2025.', 
 (SELECT comment_id FROM product_comments WHERE content LIKE 'Does this have%' LIMIT 1)),
((SELECT product_id FROM products WHERE name LIKE 'Canon%' LIMIT 1), 
 (SELECT id FROM users WHERE email = 'john.seller@example.com'), 
 'Sensor is pristine, body has minor wear on bottom plate from tripod use.', 
 (SELECT comment_id FROM product_comments WHERE content LIKE 'Any scratches%' LIMIT 1));

-- ============================================
-- 11. SEED COMPLETED ORDERS (FOR DEMO)
-- ============================================

-- Insert a sold product first
INSERT INTO products (
    category_id, 
    seller_id, 
    highest_bidder_id,
    name, 
    current_price, 
    start_price, 
    step_price,
    start_time,
    end_time,
    bid_count,
    status
) VALUES
(
    (SELECT category_id FROM categories WHERE name = 'Laptops'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    (SELECT id FROM users WHERE email = 'jane.bidder@example.com'),
    'Dell XPS 15 - 1TB SSD',
    1200.00,
    1000.00,
    50.00,
    CURRENT_TIMESTAMP - INTERVAL '15 days',
    CURRENT_TIMESTAMP - INTERVAL '8 days',
    12,
    'sold'
);

-- Create order for sold product
INSERT INTO orders (product_id, winner_id, seller_id, final_price, status) VALUES
(
    (SELECT product_id FROM products WHERE name LIKE 'Dell XPS%' LIMIT 1),
    (SELECT id FROM users WHERE email = 'jane.bidder@example.com'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    1200.00,
    'completed'
);

-- Create invoice for the order
INSERT INTO invoices (order_id, shipping_address, payment_proof_url, shipping_tracking_code) VALUES
(
    (SELECT order_id FROM orders WHERE product_id = (SELECT product_id FROM products WHERE name LIKE 'Dell XPS%' LIMIT 1)),
    '123 Main St, San Francisco, CA 94102, USA',
    'https://example.com/payment-proof-12345.pdf',
    'UPS-1234567890'
);

-- ============================================
-- 12. SEED REVIEWS
-- ============================================

-- Jane reviews John (seller) - positive
INSERT INTO reviews (order_id, reviewer_id, reviewered_id, rating, content) VALUES
(
    (SELECT order_id FROM orders WHERE product_id = (SELECT product_id FROM products WHERE name LIKE 'Dell XPS%' LIMIT 1)),
    (SELECT id FROM users WHERE email = 'jane.bidder@example.com'),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    1,
    'Excellent seller! Item was exactly as described, fast shipping, great communication.'
);

-- John reviews Jane (buyer) - positive
INSERT INTO reviews (order_id, reviewer_id, reviewered_id, rating, content) VALUES
(
    (SELECT order_id FROM orders WHERE product_id = (SELECT product_id FROM products WHERE name LIKE 'Dell XPS%' LIMIT 1)),
    (SELECT id FROM users WHERE email = 'john.seller@example.com'),
    (SELECT id FROM users WHERE email = 'jane.bidder@example.com'),
    1,
    'Great buyer, fast payment, smooth transaction. Highly recommended!'
);

-- ============================================
-- 13. SEED NOTIFICATIONS
-- ============================================

INSERT INTO notifications (user_id, type, content, action_url, is_read) VALUES
-- Jane's notifications
((SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 'bid_outbid', 'You have been outbid on iPhone 14 Pro', '/auction/1', FALSE),
((SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 'auction_ending', 'Auction ending soon: iPhone 14 Pro (5 hours left)', '/auction/1', FALSE),
((SELECT id FROM users WHERE email = 'jane.bidder@example.com'), 'order_completed', 'Your order for Dell XPS 15 has been completed', '/orders/1', TRUE),

-- Bob's notifications
((SELECT id FROM users WHERE email = 'bob.smith@example.com'), 'bid_placed', 'Your bid on MacBook Pro has been placed successfully', '/auction/2', TRUE),
((SELECT id FROM users WHERE email = 'bob.smith@example.com'), 'watchlist_ending', 'Watched auction ending soon: iPhone 14 Pro', '/auction/1', FALSE),

-- Alice's notifications
((SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 'bid_outbid', 'You have been outbid on iPhone 14 Pro', '/auction/1', FALSE),
((SELECT id FROM users WHERE email = 'alice.johnson@example.com'), 'new_comment', 'New comment on Canon EOS R6 Mark II', '/auction/3', FALSE),

-- John's (seller) notifications
((SELECT id FROM users WHERE email = 'john.seller@example.com'), 'new_bid', 'New bid placed on your iPhone 14 Pro', '/auction/1', TRUE),
((SELECT id FROM users WHERE email = 'john.seller@example.com'), 'auction_ending', 'Your auction for PlayStation 5 ending in 24 hours', '/my-auctions', FALSE);

-- ============================================
-- 14. SEED UPGRADE REQUESTS
-- ============================================

-- Charlie wants to become a seller
INSERT INTO upgrade_requests (user_id, status) VALUES
((SELECT id FROM users WHERE email = 'charlie.brown@example.com'), 'pending');

-- David already approved
INSERT INTO upgrade_requests (user_id, status, approved_at) VALUES
((SELECT id FROM users WHERE email = 'david.lee@example.com'), 'approved', CURRENT_TIMESTAMP - INTERVAL '2 days');

-- Add seller role to David after approval
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM users_roles ur
        JOIN users u ON ur.user_id = u.id
        JOIN roles r ON ur.role_id = r.role_id
        WHERE u.email = 'david.lee@example.com' AND r.name = 'seller'
    ) THEN
        INSERT INTO users_roles (user_id, role_id)
        SELECT u.id, r.role_id 
        FROM users u, roles r 
        WHERE u.email = 'david.lee@example.com' AND r.name = 'seller';
    END IF;
END $$;

-- ============================================
-- VERIFICATION QUERIES
-- ============================================

-- Check data counts
DO $$
DECLARE
    user_count INT;
    category_count INT;
    product_count INT;
    bid_count INT;
    review_count INT;
BEGIN
    SELECT COUNT(*) INTO user_count FROM users;
    SELECT COUNT(*) INTO category_count FROM categories;
    SELECT COUNT(*) INTO product_count FROM products;
    SELECT COUNT(*) INTO bid_count FROM bids;
    SELECT COUNT(*) INTO review_count FROM reviews;
    
    RAISE NOTICE 'Seed data summary:';
    RAISE NOTICE '- Users: %', user_count;
    RAISE NOTICE '- Categories: %', category_count;
    RAISE NOTICE '- Products: %', product_count;
    RAISE NOTICE '- Bids: %', bid_count;
    RAISE NOTICE '- Reviews: %', review_count;
END $$;

-- Display active auctions
SELECT 
    p.product_id,
    p.name,
    c.name as category,
    u.full_name as seller,
    p.current_price,
    p.bid_count,
    p.end_time - CURRENT_TIMESTAMP as time_remaining
FROM products p
JOIN categories c ON p.category_id = c.category_id
JOIN users u ON p.seller_id = u.id
WHERE p.status = 'active'
ORDER BY p.end_time ASC;

-- ============================================
-- END OF SEED FILE
-- ============================================
