@startuml UC03_TimKiemSanPham
' --- Cài đặt Sơ đồ ---
autonumber
actor Guest
participant "Web Browser" as Browser
participant "Web Server\n(Controller)" as Controller
participant "Search Service\n(Business Logic)" as SearchService
participant "Product Repository\n(Data Access)" as ProductRepo
database "Database" as DB

' --- Luồng chính: Tìm kiếm thành công ---

Guest -> Browser : Nhập từ khoá, (tùy chọn) chọn danh mục, sắp xếp
Browser -> Controller : Gửi yêu cầu tìm kiếm (GET /search?q=...&category=...)

activate Controller
Controller -> SearchService : searchProducts(keywords, category, pagination)
activate SearchService

SearchService -> ProductRepo : findProducts(keywords, category, pagination)
activate ProductRepo

ProductRepo -> DB : Thực hiện truy vấn (SELECT ... WHERE ... [Full-text search])
activate DB
DB --> ProductRepo : Trả về danh sách sản phẩm
deactivate DB
deactivate ProductRepo

SearchService --> Controller : Trả về danh sách sản phẩm và thông tin phân trang
deactivate SearchService

Controller -> Browser : Hiển thị trang kết quả tìm kiếm (với danh sách sản phẩm)
deactivate Controller

@enduml
