@startuml UC08_DangSanPhamDauGia
' --- Cài đặt Sơ đồ ---
autonumber
actor Seller
participant "Web Browser" as Browser
participant "Web Server\n(Controller)" as Controller
participant "Image Service\n(Cloud Storage)" as ImageService
participant "Product Service\n(Business Logic)" as ProductService
participant "Product Repository\n(Data Access)" as ProductRepo
database "Database" as DB

' --- Luồng chính: Đăng sản phẩm thành công ---

Seller -> Browser : Truy cập form "Đăng sản phẩm"
Browser -> Controller : (GET /products/new)
Controller -> Browser : Hiển thị form

Seller -> Browser : Điền thông tin (Tên, Giá, Mô tả...)
Seller -> Browser : Tải lên 3+ ảnh
Browser -> Controller : Gửi dữ liệu (POST /products, multipart/form-data)

activate Controller

' 1. Xử lý Upload Ảnh (giả định 3 ảnh)
Controller -> ImageService : uploadImages(files)
activate ImageService
ImageService --> Controller : Trả về danh sách URLs (url1, url2, url3)
deactivate ImageService

' 2. Tạo sản phẩm
Controller -> ProductService : createProduct(sellerId, formData, imageUrls)
activate ProductService

' 3. Validate dữ liệu (trong Service)
ProductService -> ProductService : Kiểm tra (>= 3 ảnh? Ngày kết thúc > NOW()?)

' 4. Lưu sản phẩm vào CSDL
ProductService -> ProductRepo : saveProduct(productData)
activate ProductRepo
ProductRepo -> DB : INSERT INTO Products (name, price, images, sellerId, ...)
activate DB
DB --> ProductRepo : Trả về Product (với ID mới)
deactivate DB
deactivate ProductRepo

ProductService --> Controller : Trả về "Tạo thành công" (với Product)
deactivate ProductService

' 5. Phản hồi
Controller -> Browser : Chuyển hướng đến trang chi tiết sản phẩm mới (GET /product/{id})
deactivate Controller

@enduml
