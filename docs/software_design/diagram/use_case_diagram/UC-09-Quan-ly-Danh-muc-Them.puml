@startuml UC09_QuanLyDanhMucThem
' --- Cài đặt Sơ đồ ---
autonumber
actor Admin
participant "Web Browser" as Browser
participant "Web Server\n(Controller)" as Controller
participant "Category Service\n(Business Logic)" as CategoryService
participant "Category Repository\n(Data Access)" as CategoryRepo
database "Database" as DB

' --- Luồng chính: Thêm Danh mục mới ---

Admin -> Browser : Điền thông tin (Tên, Danh mục cha), nhấn "Lưu"
Browser -> Controller : Gửi yêu cầu (POST /admin/categories)

activate Controller
Controller -> CategoryService : createCategory(categoryData)
activate CategoryService

' 1. (Tùy chọn) Kiểm tra tên trùng lặp
CategoryService -> CategoryRepo : findByName(categoryData.name)
activate CategoryRepo
CategoryRepo -> DB : SELECT 1 FROM Categories WHERE name = :name
activate DB
DB --> CategoryRepo : (null)
deactivate DB
deactivate CategoryRepo

' 2. Lưu danh mục mới
CategoryService -> CategoryRepo : save(categoryData)
activate CategoryRepo
CategoryRepo -> DB : INSERT INTO Categories (name, parentId) VALUES (...)
activate DB
DB --> CategoryRepo : Trả về Category (với ID mới)
deactivate DB
deactivate CategoryRepo

CategoryService --> Controller : Trả về "Tạo thành công"
deactivate CategoryService

Controller -> Browser : Phản hồi (HTTP 200) / Tải lại trang Quản lý
deactivate Controller

@enduml
