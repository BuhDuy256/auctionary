@startuml UC07_HoiDapDatCauHoi
' --- Cài đặt Sơ đồ ---
autonumber
actor Bidder
participant "Web Browser" as Browser
participant "Web Server\n(Controller)" as Controller
participant "QnAService\n(Business Logic)" as QnAService
participant "QnARepository\n(Data Access)" as QnARepo
participant "Email Service" as EmailService
database "Database" as DB

' --- Luồng chính: Bidder đặt câu hỏi ---

Bidder -> Browser : Nhập câu hỏi, nhấn "Gửi"
Browser -> Controller : Gửi yêu cầu (POST /product/{id}/question)

activate Controller
Controller -> QnAService : askQuestion(userId, productId, questionText)
activate QnAService

' 1. Lưu câu hỏi vào CSDL
QnAService -> QnARepo : saveQuestion(userId, productId, questionText)
activate QnARepo
QnARepo -> DB : INSERT INTO Questions (productId, askedById, question) VALUES (...)
activate DB
DB --> QnARepo : Trả về Question (với ID mới)
deactivate DB
deactivate QnARepo

' 2. Gửi thông báo cho Người bán
QnAService -> EmailService : notifySeller(sellerId, questionId)
activate EmailService
EmailService --> QnAService : (async) OK
deactivate EmailService

QnAService --> Controller : Trả về "Gửi câu hỏi thành công"
deactivate QnAService

Controller -> Browser : Phản hồi (HTTP 200) / Tải lại trang
deactivate Controller

@enduml
