@startuml UC07_HoiDapTraLoi
' --- Cài đặt Sơ đồ ---
autonumber
actor Seller
participant "Web Browser" as Browser
participant "Web Server\n(Controller)" as Controller
participant "QnAService\n(Business Logic)" as QnAService
participant "QnARepository\n(Data Access)" as QnARepo
database "Database" as DB

' --- Luồng chính: Seller trả lời câu hỏi ---

Seller -> Browser : Nhập câu trả lời, nhấn "Gửi"
Browser -> Controller : Gửi yêu cầu (POST /question/{id}/answer)

activate Controller
Controller -> QnAService : answerQuestion(sellerId, questionId, answerText)
activate QnAService

' 1. (Tùy chọn) Xác thực Seller có quyền trả lời
QnAService -> QnARepo : findQuestionById(questionId)
activate QnARepo
QnARepo -> DB : SELECT productId FROM Questions WHERE id = :questionId
activate DB
DB --> QnARepo : (Product)
deactivate DB
deactivate QnARepo
QnAService -> QnAService : Kiểm tra (Product.sellerId == sellerId)

' 2. Lưu câu trả lời
QnAService -> QnARepo : saveAnswer(questionId, answerText)
activate QnARepo
QnARepo -> DB : UPDATE Questions SET answer = :answerText, answeredAt = NOW() WHERE id = :questionId
activate DB
DB --> QnARepo : OK
deactivate DB
deactivate QnARepo

' 3. (Tùy chọn) Gửi email thông báo cho Bidder đã hỏi

QnAService --> Controller : Trả về "Trả lời thành công"
deactivate QnAService

Controller -> Browser : Phản hồi (HTTP 200) / Tải lại trang
deactivate Controller

@enduml
