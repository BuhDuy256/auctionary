@startuml UC-01-Dang-ky-tai-khoan

title UC-01: Đăng ký tài khoản

actor "Người dùng" as User
participant "Frontend\n(SignUpPage)" as Frontend
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components:
  - Form đăng ký (họ tên, email, địa chỉ, mật khẩu)
  - reCAPTCHA
  - Nút "Sign Up"
end note

User -> Frontend: Nhập thông tin đăng ký\n(họ tên, email, địa chỉ, mật khẩu)
User -> Frontend: Hoàn thành reCAPTCHA
User -> Frontend: Click "Sign Up"

Frontend -> Backend: Đăng ký tài khoản
activate Backend

Backend -> DB: Kiểm tra email đã tồn tại
activate DB
DB --> Backend: Kết quả kiểm tra
deactivate DB

alt Email đã tồn tại
    Backend --> Frontend: Lỗi: Email đã được sử dụng
    Frontend --> User: Hiển thị thông báo lỗi
else Email hợp lệ
    Backend -> Backend: Mã hóa mật khẩu (bcrypt)
    Backend -> Backend: Tạo mã OTP
    
    Backend -> DB: Lưu thông tin người dùng
    activate DB
    DB --> Backend: Lưu thành công
    deactivate DB
    
    Backend -> Backend: Gửi email OTP xác nhận
    
    Backend --> Frontend: Đăng ký thành công\n(yêu cầu xác nhận OTP)
    deactivate Backend
    
    Frontend --> User: Chuyển sang trang xác nhận OTP
end

@enduml
