@startuml UC-03-Tim-kiem-san-pham

title UC-03: Tìm kiếm sản phẩm

actor "Người dùng" as User
participant "Frontend\n(SearchPage)" as Frontend
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components:
  - Thanh tìm kiếm (tên sản phẩm)
  - Dropdown chọn danh mục
  - Dropdown sắp xếp (giá, thời gian)
  - Danh sách sản phẩm (card view)
  - Phân trang
end note

User -> Frontend: Nhập từ khóa tìm kiếm
User -> Frontend: Chọn danh mục (optional)
User -> Frontend: Chọn sắp xếp (optional)
User -> Frontend: Click "Search"

Frontend -> Backend: Tìm kiếm sản phẩm\n(keyword, category, sortBy)
activate Backend

Backend -> DB: Full-text search sản phẩm
activate DB
note right of DB
  Query:
  - WHERE MATCH(name) AGAINST(keyword)
  - Filter by category
  - ORDER BY sortBy
  - LIMIT, OFFSET (phân trang)
end note
DB --> Backend: Danh sách sản phẩm
deactivate DB

Backend -> Backend: Đánh dấu sản phẩm mới\n(đăng trong N phút)

Backend --> Frontend: Kết quả tìm kiếm\n(products, total, page info)
deactivate Backend

Frontend --> User: Hiển thị danh sách sản phẩm
note over Frontend
  Mỗi sản phẩm hiển thị:
  - Ảnh đại diện
  - Tên sản phẩm
  - Giá hiện tại
  - Người đặt giá cao nhất (masked)
  - Giá mua ngay (nếu có)
  - Thời gian còn lại
  - Số lượt ra giá
  - Badge "NEW" (nếu mới đăng)
end note

User -> Frontend: Click vào danh mục
Frontend --> User: Chuyển đến trang danh sách sản phẩm theo danh mục

User -> Frontend: Click chọn trang khác (phân trang)
Frontend -> Backend: Tìm kiếm sản phẩm trang mới
activate Backend
Backend -> DB: Query trang mới
activate DB
DB --> Backend: Danh sách sản phẩm trang mới
deactivate DB
Backend --> Frontend: Kết quả trang mới
deactivate Backend
Frontend --> User: Hiển thị sản phẩm trang mới

@enduml
