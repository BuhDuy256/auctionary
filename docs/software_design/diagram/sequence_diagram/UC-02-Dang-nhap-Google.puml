@startuml UC-02-Dang-nhap-Google

title UC-02: Đăng nhập - Google

actor "Người dùng" as User
participant "Frontend\n(LoginPage)" as Frontend
participant "Google OAuth" as Google
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components:
  - Nút "Continue with Google"
  - Google OAuth popup
end note

User -> Frontend: Click "Continue with Google"
Frontend -> Google: Mở popup OAuth (flow: auth-code)
activate Google

Google --> User: Hiển thị màn hình đăng nhập Google
User -> Google: Đăng nhập và cấp quyền

Google --> Frontend: Trả về authorization code
deactivate Google

Frontend -> Backend: Đăng nhập với Google\n(authorization code)
activate Backend

Backend -> Google: Đổi code lấy tokens và user info
activate Google
Google --> Backend: Access token + user info (email, name, picture)
deactivate Google

Backend -> DB: Tìm user theo email
activate DB
DB --> Backend: Kết quả tìm kiếm
deactivate DB

alt User chưa tồn tại
    Backend -> DB: Tạo user mới từ thông tin Google
    activate DB
    DB --> Backend: User mới được tạo
    deactivate DB
    
    Backend -> Backend: Tạo JWT token
    Backend --> Frontend: Đăng nhập thành công\n(accessToken, user info)
    deactivate Backend
    Frontend -> Frontend: Lưu token vào localStorage
    Frontend --> User: Chuyển đến trang chủ
else User đã tồn tại
    Backend -> Backend: Tạo JWT token
    Backend --> Frontend: Đăng nhập thành công\n(accessToken, user info)
    deactivate Backend
    Frontend -> Frontend: Lưu token vào localStorage
    Frontend --> User: Chuyển đến trang chủ
end

@enduml
