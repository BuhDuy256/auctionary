@startuml UC-09-Quan-ly-Danh-muc

title UC-09: Quản lý danh mục (Admin)

actor "Admin" as Admin
participant "Frontend\n(CategoryManagementPage)" as Frontend
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components:
  - Table danh sách danh mục
  - Modal thêm/sửa danh mục
  - Nút "Thêm danh mục"
  - Nút "Sửa" / "Xóa" trên mỗi row
  - Tree view (2 cấp: Parent - Child)
end note

== Xem danh sách danh mục ==

Admin -> Frontend: Truy cập trang quản lý danh mục

Frontend -> Backend: Lấy danh sách danh mục
activate Backend

Backend -> DB: Query tất cả danh mục
activate DB
DB --> Backend: Danh sách danh mục (2 cấp)
deactivate DB

Backend --> Frontend: Danh sách danh mục
deactivate Backend

Frontend --> Admin: Hiển thị tree view danh mục

== Thêm danh mục mới ==

Admin -> Frontend: Click "Thêm danh mục"
Frontend --> Admin: Hiển thị modal

Admin -> Frontend: Nhập thông tin danh mục\n(tên, parent category)
Admin -> Frontend: Click "Lưu"

Frontend -> Backend: Tạo danh mục mới\n(name, parentId)
activate Backend

Backend -> DB: Kiểm tra tên danh mục đã tồn tại
activate DB
DB --> Backend: Kết quả kiểm tra
deactivate DB

alt Tên đã tồn tại
    Backend --> Frontend: Lỗi: Tên danh mục đã tồn tại
    deactivate Backend
    Frontend --> Admin: Hiển thị thông báo lỗi
else Tên hợp lệ
    Backend -> DB: Lưu danh mục mới
    activate DB
    DB --> Backend: Lưu thành công
    deactivate DB
    
    Backend --> Frontend: Tạo thành công
    deactivate Backend
    Frontend --> Admin: Cập nhật danh sách\nĐóng modal
end

== Xóa danh mục ==

Admin -> Frontend: Click "Xóa" trên danh mục
Frontend --> Admin: Hiển thị dialog xác nhận

Admin -> Frontend: Xác nhận xóa

Frontend -> Backend: Xóa danh mục\n(categoryId)
activate Backend

Backend -> DB: Kiểm tra danh mục có sản phẩm không
activate DB
DB --> Backend: Số lượng sản phẩm
deactivate DB

alt Có sản phẩm
    Backend --> Frontend: Lỗi: Không thể xóa danh mục có sản phẩm
    deactivate Backend
    Frontend --> Admin: Hiển thị thông báo lỗi
else Không có sản phẩm
    Backend -> DB: Xóa danh mục
    activate DB
    DB --> Backend: Xóa thành công
    deactivate DB
    
    Backend --> Frontend: Xóa thành công
    deactivate Backend
    Frontend --> Admin: Cập nhật danh sách
end

@enduml
