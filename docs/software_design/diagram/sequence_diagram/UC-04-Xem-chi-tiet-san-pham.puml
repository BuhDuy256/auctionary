@startuml UC-04-Xem-chi-tiet-san-pham

title UC-04: Xem chi tiết sản phẩm

actor "Người dùng" as User
participant "Frontend\n(ProductDetailPage)" as Frontend
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components:
  - Ảnh sản phẩm (đại diện + phụ)
  - Thông tin sản phẩm (tên, giá, mô tả)
  - Thông tin người bán & rating
  - Thông tin người đặt giá cao nhất & rating
  - Thời gian đăng/kết thúc (relative time)
  - Nút "Add to Watch List"
  - Nút "Place Bid" (cho bidder)
  - Form hỏi đáp
  - Lịch sử câu hỏi & trả lời
  - 5 sản phẩm cùng danh mục
end note

User -> Frontend: Click vào sản phẩm

Frontend -> Backend: Lấy chi tiết sản phẩm\n(productId)
activate Backend

Backend -> DB: Query thông tin sản phẩm
activate DB
DB --> Backend: Thông tin sản phẩm đầy đủ
deactivate DB

Backend -> DB: Lấy thông tin người bán + rating
activate DB
DB --> Backend: Seller info & rating
deactivate DB

Backend -> DB: Lấy người đặt giá cao nhất + rating
activate DB
DB --> Backend: Top bidder info & rating
deactivate DB

Backend -> DB: Lấy lịch sử Q&A
activate DB
DB --> Backend: Danh sách câu hỏi & câu trả lời
deactivate DB

Backend -> DB: Lấy 5 sản phẩm cùng danh mục
activate DB
DB --> Backend: Related products
deactivate DB

Backend --> Frontend: Chi tiết sản phẩm đầy đủ
deactivate Backend

Frontend -> Frontend: Format thời gian kết thúc\n(relative time nếu < 3 ngày)
Frontend --> User: Hiển thị chi tiết sản phẩm

alt User là Bidder
    User -> Frontend: Click "Add to Watch List"
    Frontend -> Backend: Thêm vào Watch List
    activate Backend
    Backend -> DB: Lưu sản phẩm vào Watch List
    activate DB
    DB --> Backend: Lưu thành công
    deactivate DB
    Backend --> Frontend: Thêm thành công
    deactivate Backend
    Frontend --> User: Hiển thị thông báo thành công
end

@enduml
