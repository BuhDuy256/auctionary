@startuml UC-10-Duyet-nang-cap-tai-khoan

title UC-10: Duyệt nâng cấp tài khoản Bidder → Seller

actor "Bidder" as Bidder
actor "Admin" as Admin
participant "Frontend" as Frontend
participant "Backend" as Backend
participant "DB" as DB

note over Frontend
  UI Components (Bidder):
  - Nút "Xin bán hàng" trong Profile
  - Thông báo trạng thái yêu cầu
  
  UI Components (Admin):
  - Table danh sách yêu cầu nâng cấp
  - Nút "Duyệt" / "Từ chối"
end note

== Bidder gửi yêu cầu nâng cấp ==

Bidder -> Frontend: Click "Xin bán hàng"
Frontend --> Bidder: Hiển thị dialog xác nhận

Bidder -> Frontend: Xác nhận yêu cầu

Frontend -> Backend: Gửi yêu cầu nâng cấp\n(userId)
activate Backend

Backend -> DB: Kiểm tra đã có yêu cầu pending
activate DB
DB --> Backend: Kết quả kiểm tra
deactivate DB

alt Đã có yêu cầu pending
    Backend --> Frontend: Lỗi: Đã có yêu cầu đang chờ duyệt
    deactivate Backend
    Frontend --> Bidder: Hiển thị thông báo
else Chưa có yêu cầu
    Backend -> DB: Lưu yêu cầu nâng cấp
    activate DB
    note right of DB
      - User ID
      - Trạng thái: PENDING
      - Thời gian gửi
    end note
    DB --> Backend: Lưu thành công
    deactivate DB
    
    Backend -> Backend: Gửi email thông báo admin
    
    Backend --> Frontend: Gửi yêu cầu thành công
    deactivate Backend
    Frontend --> Bidder: Hiển thị thông báo\n"Yêu cầu đang chờ duyệt"
end

== Admin duyệt yêu cầu ==

Admin -> Frontend: Truy cập trang quản lý yêu cầu

Frontend -> Backend: Lấy danh sách yêu cầu nâng cấp
activate Backend

Backend -> DB: Query yêu cầu PENDING
activate DB
DB --> Backend: Danh sách yêu cầu
deactivate DB

Backend --> Frontend: Danh sách yêu cầu
deactivate Backend

Frontend --> Admin: Hiển thị table yêu cầu

alt Admin duyệt
    Admin -> Frontend: Click "Duyệt"
    
    Frontend -> Backend: Duyệt yêu cầu\n(requestId, APPROVED)
    activate Backend
    
    Backend -> DB: Cập nhật role user thành SELLER
    activate DB
    DB --> Backend: Cập nhật thành công
    deactivate DB
    
    Backend -> DB: Cập nhật trạng thái yêu cầu
    activate DB
    DB --> Backend: Cập nhật thành công
    deactivate DB
    
    Backend -> Backend: Gửi email thông báo bidder\n"Tài khoản đã được nâng cấp"
    
    Backend --> Frontend: Duyệt thành công
    deactivate Backend
    Frontend --> Admin: Cập nhật danh sách
else Admin từ chối
    Admin -> Frontend: Click "Từ chối"
    
    Frontend -> Backend: Từ chối yêu cầu\n(requestId, REJECTED)
    activate Backend
    
    Backend -> DB: Cập nhật trạng thái yêu cầu
    activate DB
    DB --> Backend: Cập nhật thành công
    deactivate DB
    
    Backend -> Backend: Gửi email thông báo bidder\n"Yêu cầu bị từ chối"
    
    Backend --> Frontend: Từ chối thành công
    deactivate Backend
    Frontend --> Admin: Cập nhật danh sách
end

@enduml
